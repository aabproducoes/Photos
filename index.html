<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Photo Gallery</title>
<style>
/* ---------- RESET ---------- */
*{box-sizing:border-box;margin:0;padding:0}
body{background:#000;color:#fff;font-family:sans-serif;overflow-y:auto} /* Changed: Allow body scrolling */

/* ---------- TOP BAR ---------- */
header{
  position:fixed;top:0;left:0;width:100%;height:50px;line-height:50px;
  text-align:center;background:rgba(0,0,0,.85);z-index:1000;
  transition:transform .45s cubic-bezier(.55,.06,.68,.19)
}
header.hidden{transform:translateY(-100%)}

/* ---------- GALLERY / CATEGORY ---------- */
.gallery-container{
  display:flex;flex-direction:column;gap:8px;padding:50px 8px 8px; /* Changed: Padding for header */
}
.category{
  position:relative;
  height:50vh; /* Frame height */
  display:flex;flex-direction:column;gap:8px;
  overflow:visible; /* Changed: Allow photos to be visible outside frame temporarily */
  perspective:800px;
}

/* Centered title */
.category h2{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  padding:8px 12px;background:rgba(0,0,0,.6);border-radius:4px;
  pointer-events:none;text-align:center;
}

/* ---------- PHOTO CARD ---------- */
.grid{
  flex:1;
  position:relative; /* Changed: Grid is the frame */
  height:100%; /* Full category height */
  display:grid;gap:8px;padding:0 8px;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  overflow:hidden; /* Changed: Mask photos outside the grid */
}
.photo{
  position:absolute; /* Changed: Absolute positioning for sliding */
  width:calc(100% / 3 - 8px * 2 / 3); /* Example: Assume 3 columns for simplicity */
  aspect-ratio:1/1;
  overflow:hidden;
  border-radius:6px;
  isolation:isolate;
  /* Start state: Below the frame */
  transform:translateY(100%) rotateX(-35deg);
  transform-origin:center bottom;
  opacity:0;
  transition:transform .7s ease, opacity .6s ease;
}
/* Position photos in the grid */
.grid .photo:nth-child(1n) { left:8px; } /* Adjust based on grid column */
.grid .photo:nth-child(2n) { left:calc(100% / 3 + 4px); }
.grid .photo:nth-child(3n) { left:calc(2 * 100% / 3 - 4px); }
/* When category gets .show, photos slide into place */
.category.show .photo{
  transform:translateY(0) rotateX(0);
  opacity:1;
}
/* Sliding for next/previous photos */
.photo.next { transform:translateY(-100%) rotateX(35deg); opacity:0; }
.photo.prev { transform:translateY(100%) rotateX(-35deg); opacity:0; }

.photo img{width:100%;height:100%;object-fit:cover;display:block}
.photo:hover img{filter:brightness(.8)}
.photo:hover{transform:scale(1.03)} /* Mild zoom */

.preview{
  position:absolute;left:0;right:0;bottom:100px;padding:6px 4px;
  background:linear-gradient(to top,rgba(0,0,0,.85),rgba(0,0,0,.3));
  transform:translateY(140%);transition:.3s;
  text-align:center;font-size:.9rem;white-space:normal;color:#fff;
  z-index:2;pointer-events:none
}
.photo:hover .preview{transform:translateY(0)}

/* ---------- NAV BUTTONS ---------- */
.nav{
  position:fixed;right:10px;top:50%;transform:translateY(-50%);
  display:flex;flex-direction:column;gap:8px;z-index:1001
}
.nav button{
  width:36px;height:36px;border:none;border-radius:50%;
  background:#0ff;color:#000;font-size:1.1rem;cursor:pointer
}
.nav button:hover:not(:disabled){background:#5ff}
.nav button:disabled{background:#333;color:#777;cursor:not-allowed}
</style>
</head>
<body>

<header id="topbar">Photos</header>

<div class="gallery-container" id="gallery"></div>

<div class="nav">
  <button id="up" disabled>↑</button>
  <button id="down">↓</button>
</div>

<script>
(async () => {
  /* ---------- LOAD JSON ---------- */
  const data = await fetch('photos.json').then(r=>r.json());
  const gallery = document.getElementById('gallery');

  data.categories.forEach(cat=>{
    const sec=document.createElement('section');
    sec.className='category';
    sec.innerHTML=`
      <h2>${cat.name}</h2>
      <div class="grid">
        ${cat.photos.map(p=>`
          <figure class="photo">
            <img src="${p.url}" alt="${p.alt}" loading="lazy">
            <figcaption class="preview">${p.title}</figcaption>
          </figure>`).join('')}
      </div>`;
    gallery.appendChild(sec);
  });

  /* Neon borders */
  document.querySelectorAll('.photo').forEach(card=>{
    const h=Math.floor(Math.random()*360);
    const neon=`hsl(${h} 100% 50%)`;
    card.style.boxShadow=`inset 0 0 12px 2px ${neon},0 0 12px 4px ${neon}`;
  });

  /* ---------- PAGING ---------- */
  const cats=document.querySelectorAll('.category');
  const up=document.getElementById('up');
  const down=document.getElementById('down');
  const bar=document.getElementById('topbar');

  // Track current photo index per category
  const photoIndices = Array(cats.length).fill(0);
  const photosPerPage = 3; // Example: 3 photos per grid (adjust based on grid columns)

  const updateButtons=(catIdx)=>{
    const photos=cats[catIdx].querySelectorAll('.photo');
    const maxIdx=Math.max(0,Math.ceil(photos.length/photosPerPage)-1);
    up.disabled=photoIndices[catIdx]===0;
    down.disabled=photoIndices[catIdx]===maxIdx;
  };

  const slidePhotos=(catIdx,dir)=>{
    const photos=cats[catIdx].querySelectorAll('.photo');
    const currentIdx=photoIndices[catIdx];
    const newIdx=dir==='next'?currentIdx+1:currentIdx-1;
    if(newIdx<0||newIdx>=Math.ceil(photos.length/photosPerPage))return;

    // Mark current photos as leaving
    photos.forEach((p,i)=>{
      if(i>=currentIdx*photosPerPage&&i<(currentIdx+1)*photosPerPage){
        p.classList.add(dir==='next'?'prev':'next');
      }
    });

    // Update index and show new photos
    photoIndices[catIdx]=newIdx;
    setTimeout(()=>{
      photos.forEach((p,i)=>{
        p.classList.remove('prev','next');
        if(i>=newIdx*photosPerPage&&i<(newIdx+1)*photosPerPage){
          p.classList.add('show');
        }else{
          p.classList.remove('show');
          p.style.transform='translateY(100%) rotateX(-35deg)';
          p.style.opacity='0';
        }
      });
    },700); // Match CSS transition duration
    updateButtons(catIdx);
  };

  // Initialize first set of photos
  cats.forEach((cat,i)=>{
    const photos=cat.querySelectorAll('.photo');
    photos.forEach((p,j)=>{
      if(j<photosPerPage)p.classList.add('show');
    });
    updateButtons(i);
  });

  /* Mouse wheel throttled */
  let lock=false;
  gallery.addEventListener('wheel',e=>{
    e.preventDefault();if(lock)return;
    lock=true;setTimeout(()=>lock=false,280);
    const catIdx=Math.floor((e.target.closest('.category')?.offsetTop||0)/window.innerHeight*2);
    if(e.deltaY>0)slidePhotos(catIdx,'next');
    else slidePhotos(catIdx,'prev');
  },{passive:false});

  /* Navigation buttons */
  let currentCat=0;
  up.addEventListener('click',()=>slidePhotos(currentCat,'prev'));
  down.addEventListener('click',()=>slidePhotos(currentCat,'next'));

  /* Update current category on scroll */
  gallery.addEventListener('scroll',()=>{
    bar.classList.toggle('hidden',gallery.scrollTop>5);
    const newCat=Math.round(gallery.scrollTop/(window.innerHeight/2));
    if(newCat!==currentCat){
      currentCat=newCat;
      updateButtons(currentCat);
    }
  });

  /* Reveal initial photos */
  const io=new IntersectionObserver(entries=>{
    entries.forEach(e=>e.isIntersecting&&e.target.classList.add('show'));
  },{root:null,threshold:.15});
  cats.forEach(c=>io.observe(c));
})();
</script>
</body>
</html>
