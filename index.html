<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Photo Gallery</title>
  <style>
    /* ---------- RESET ---------- */
    * { box-sizing:border-box; margin:0; padding:0 }
    body { background:#000; color:#fff; font-family:sans-serif; overflow:hidden }

    /* ---------- CONTAINER ---------- */
    .gallery-container {
      position: relative;
      padding:20px;
      display: flex; flex-direction: column; align-items: center;
      min-height:100vh;
    }

    .category-title {
      margin-bottom:16px;
      font-size:1.5rem;
      background:rgba(0,0,0,.6);
      padding:8px 16px;
      border-radius:4px;
    }

    /* ---------- GRID & PHOTOS ---------- */
    .photo-grid {
      display:grid;
      grid-template-columns:repeat(3,minmax(200px,1fr));
      gap:16px;
      max-width:1000px;
      position:relative;
    }
    .photo {
      position:relative;
      overflow:hidden;
      border-radius:6px;
      cursor:pointer;
      transform-origin:50% 50%;
      transition:transform .5s ease;
    }
    /* Enter animation */
    .photo.enter {
      opacity:0;
      transform: translateX(var(--dx,0)) rotateY(var(--ry,15deg)) scale(.8);
      animation:photoIn .6s forwards;
    }
    @keyframes photoIn {
      to { opacity:1; transform: translateX(0) rotateY(0) scale(1); }
    }
    /* Exit animation */
    .photo.exit {
      animation:photoOut .5s forwards;
    }
    @keyframes photoOut {
      to { opacity:0; transform: translateX(var(--dx,0)) rotateY(var(--ry,-15deg)) scale(.8); }
    }
    .photo img {
      display:block; width:100%; height:100%; object-fit:cover;
    }
    .preview {
      position:absolute;left:0;right:0;bottom:0;
      background:linear-gradient(to top,rgba(0,0,0,.85),rgba(0,0,0,.3));
      padding:6px; text-align:center; font-size:.9rem;
      color:#fff; transform:translateY(100%);
      transition:transform .3s;
      pointer-events:none; z-index:2;
    }
    .photo:hover .preview {
      transform:translateY(0);
    }

    /* ---------- NAVIGATION ---------- */
    .nav {
      position:fixed; top:50%; left:0; right:0;
      display:flex; justify-content:space-between;
      padding:0 20px;
      transform:translateY(-50%);
      pointer-events:none;
    }
    .nav button {
      pointer-events:all;
      background:#0ff; border:none; border-radius:50%;
      width:40px; height:40px; font-size:1.2rem; cursor:pointer;
      transition:background .3s;
    }
    .nav button:disabled { background:#333; color:#777; cursor:not-allowed }
    .nav button:hover:not(:disabled) { background:#5ff }
    /* category labels */
    .nav .label {
      position:absolute; width:100px; text-align:center;
      font-size:.9rem; background:rgba(0,0,0,.6);
      padding:4px 8px; border-radius:4px;
    }
    #leftLabel { left:60px; transform:translateY(-50%) }
    #rightLabel{ right:60px; transform:translateY(-50%) }

    /* ---------- LIGHTBOX ---------- */
    #lightbox {
      position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,.9);
      display:none; align-items:center; justify-content:center;
      z-index:2000; flex-direction:column;
    }
    #lightbox img {
      max-width:90%; max-height:80%; border-radius:8px;
    }
    #lightbox .lb-nav {
      position:absolute; top:50%; width:100%;
      display:flex; justify-content:space-between;
      padding:0 20px; transform:translateY(-50%);
    }
    #lightbox .lb-nav button {
      background:rgba(255,255,255,.3); border:none;
      width:50px; height:50px; border-radius:50%;
      font-size:2rem; color:#fff; cursor:pointer;
    }
    #lightbox .close {
      position:absolute; top:20px; right:20px;
      background:rgba(255,255,255,.3); border:none;
      width:40px; height:40px; border-radius:50%;
      font-size:1.5rem; color:#fff; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="gallery-container" id="gallery">
    <div class="loading">Loading photos…</div>
  </div>

  <div class="nav">
    <button id="left" disabled>←</button>
    <div id="leftLabel" class="label"></div>
    <button id="right" disabled>→</button>
    <div id="rightLabel" class="label"></div>
  </div>

  <div id="lightbox">
    <button class="close" aria-label="Close">×</button>
    <div class="lb-nav">
      <button id="lb-prev" aria-label="Previous">←</button>
      <button id="lb-next" aria-label="Next">→</button>
    </div>
    <img src="" alt="" id="lb-img">
    <div class="preview" id="lb-caption"></div>
  </div>

  <script>
  (async()=>{
    const gallery = document.getElementById('gallery');
    const leftBtn = document.getElementById('left');
    const rightBtn= document.getElementById('right');
    const leftLbl = document.getElementById('leftLabel');
    const rightLbl= document.getElementById('rightLabel');
    const lb       = document.getElementById('lightbox');
    const lbImg    = document.getElementById('lb-img');
    const lbCap    = document.getElementById('lb-caption');
    const lbPrev   = document.getElementById('lb-prev');
    const lbNext   = document.getElementById('lb-next');
    const lbClose  = lb.querySelector('.close');

    let data;
    try {
      data = await fetch('photos.json').then(r=>r.json());
    } catch {
      gallery.innerHTML = '<div class="error">Failed to load.</div>';
      return;
    }
    let catIdx=0, start=0, per=3;
    let lightIdx=0;

    function updateLabels(){
      leftLbl.textContent  = data.categories[catIdx-1]?.name || '';
      rightLbl.textContent = data.categories[catIdx+1]?.name || '';
    }

    function render(){
      gallery.innerHTML = `
        <div class="category-title">${data.categories[catIdx].name}</div>
        <div class="photo-grid"></div>`;
      const grid = gallery.querySelector('.photo-grid');
      const photos = data.categories[catIdx].photos.slice(start, start+per);
      while(photos.length<per) photos.push({url:'',alt:'',title:''});
      photos.forEach((p,i)=>{
        const fig = document.createElement('figure');
        fig.className='photo enter';
        fig.style.setProperty('--dx', (i-per/2)*50+'px');
        fig.style.setProperty('--ry', (i-per/2)*15+'deg');
        if(!p.url) {
          fig.classList.add('empty');
          fig.textContent='No Image';
        } else {
          fig.innerHTML=`
            <img src="${p.url}" alt="${p.alt}">
            <figcaption class="preview">${p.title}</figcaption>`;
          fig.addEventListener('click',()=>{
            lightIdx = start + i;
            openLightbox();
          });
        }
        grid.append(fig);
      });
      leftBtn.disabled  = (catIdx===0 && start===0);
      rightBtn.disabled = (catIdx===data.categories.length-1 && start+per>=data.categories[catIdx].photos.length);
      updateLabels();
    }

    function page(dir){
      const cat = data.categories[catIdx].photos.length;
      const nextStart = start + dir*per;
      if(nextStart>=0 && nextStart+per<=cat){
        start = nextStart;
      } else if(dir>0 && catIdx<data.categories.length-1){
        catIdx++; start=0;
      } else if(dir<0 && catIdx>0){
        catIdx--; start = Math.max(0, data.categories[catIdx].photos.length-per);
      }
      // animate out
      document.querySelectorAll('.photo').forEach((el,i)=>{
        el.classList.add('exit');
      });
      setTimeout(()=>{
        render();
      },300);
    }

    function openLightbox(){
      const curr = data.categories[catIdx].photos[lightIdx];
      lbImg.src = curr.url;
      lbCap.textContent = curr.title;
      lb.style.display='flex';
    }
    function closeLightbox(){
      lb.style.display='none';
    }
    lbPrev.onclick = ()=>{ lightIdx = Math.max(0, lightIdx-1); openLightbox() };
    lbNext.onclick = ()=>{ lightIdx = Math.min(data.categories[catIdx].photos.length-1, lightIdx+1); openLightbox() };
    lbClose.onclick = closeLightbox;
    document.addEventListener('keydown',e=>{
      if(e.key==='Escape') closeLightbox();
      if(e.key==='ArrowLeft'&&!leftBtn.disabled) leftBtn.click();
      if(e.key==='ArrowRight'&&!rightBtn.disabled) rightBtn.click();
    });

    leftBtn.onclick  = ()=>page(-1);
    rightBtn.onclick = ()=>page(1);

    render();
  })();
  </script>
</body>
</html>
